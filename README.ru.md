# Пакет Heartbeat

Пакет `heartbeat` предоставляет простой механизм для создания или обновления файла с временной меткой, который может использоваться для мониторинга состояния приложения или его активности.

## Возможности

- Автоматическая инициализация с использованием пути по умолчанию или заданного через переменную окружения.
- Предоставляет функцию `Refresh` для создания или обновления файла с текущей временной меткой.
- Логирует предупреждения в случае ошибок при работе с файлами.

## Установка

```bash
go get github.com/safeblock-dev/heartbeat
```

## Использование

### Базовый пример

```go
package main

import (
	"fmt"
	"time"

	"github.com/safeblock-dev/heartbeat"
)

func main() {
	fmt.Println("Запуск heartbeat...")

	// Обновление файла heartbeat текущей временной меткой
	heartbeat.Refresh()
	fmt.Println("Файл heartbeat обновлен.")

	// Симуляция задержки
	time.Sleep(5 * time.Second)

	// Повторное обновление файла heartbeat
	heartbeat.Refresh()
	fmt.Println("Файл heartbeat снова обновлен.")
}
```

### Пользовательский путь к файлу

Вы можете указать пользовательский путь к файлу heartbeat, задав переменную окружения `HEARTBEAT_FILE`:

```bash
export HEARTBEAT_FILE=/path/to/custom/heartbeat.timestamp
```

Пакет будет использовать указанный путь вместо пути по умолчанию (`heartbeat.timestamp`).

### Скрипт проверки файла

Вместе с пакетом можно использовать [скрипт](check_liveness.sh) для проверки файла heartbeat. Этот скрипт проверяет наличие файла и его возраст, возвращая статус 0, если файл обновлялся в пределах заданного таймаута (по умолчанию 30 секунд), и 1 в противном случае.

#### Пример интеграции

Этот скрипт можно использовать в вашем приложении для проверки состояния. Например, при использовании Kubernetes, он может быть вызван в качестве команды для проверки живучести (liveness probe):

```yaml
livenessProbe:
  exec:
    command:
    - "/path/to/check_liveness.sh"
  initialDelaySeconds: 5
  periodSeconds: 10
```  

## Логирование

Пакет логирует предупреждения в случае возникновения ошибок при работе с файлами, например:

- Ошибка создания или открытия файла.
- Ошибка записи в файл.
- Ошибка закрытия файла.

Все предупреждения выводятся с использованием стандартного логгера.
